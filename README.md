![](https://kartinki.pics/uploads/posts/2022-12/1671734665_kartinkin-net-p-kartinki-turizm-dlya-detei-pinterest-56.png)

  Виртуальная стажировка
-
 ### Pereval Rest API

***
Федерации спортивного туризма России  [<u>pereval.online</u>](https://pereval.online/) (далее - ФСТР) заказала 
студентам SkillFactory разработать мобильное приложение для Android и IOS, 
которое упростило бы туристам задачу по отправке данных о перевале и сократило время обработки запроса до трёх дней.

Пользоваться мобильным приложением будут туристы. В горах они будут вносить 
данные о перевале в приложение и отправлять их в ФСТР, как только появится доступ
в Интернет.

Модератор из федерации будет верифицировать и вносить в базу данных информацию,
полученную от пользователей, а те в свою очередь смогут увидеть в мобильном
приложении статус модерации и просматривать базу с объектами, внесёнными другими.
***
Турист с помощью мобильного приложения будет передавать в ФСТР следующие данные о перевале:

* Информацию о себе:
  * Фамилия;
  * Имя;
  * Отчество;
  * Электронная почта;
  * Номер телефона.
* Название объекта;
* Координаты объекта и его высоту;
* Уровень сложности в зависимости от времени года;
* Несколько фотографий.
После этого турист нажимает кнопку «Отправить» в мобильном приложении. Мобильное приложение вызовет метод Pereval.
***
_Метод:_

#### _**POST/submitData**_
принимает JSON в теле запроса с информацией о перевале. Пример JSON-а:

```
{
            'beauty_title': 'Вершина',
            'title': 'Купол трёх озер',
            'other_titles': 'Купол Актру',
            'connect': 'хребет',
            'add_time': "2021-09-22 13:18:13",
            'user': {
                'email': 'perg@example.com',
                'phone': '+13337772548',
                'fam': 'Анисимов',
                'name': 'Владимир',
                'otc': 'Петрович',
            },
            'coords': {
                'latitude': '50.048400',
                'longitude': '87.796590',
                'height': 3556
            },
            'status': 'new',
            'level': {
                'winter': '1Б',
                'summer': '1Б',
                "autumn": '1Б',
                'spring': '1Б',
            },
            'images': [
                {
                    'image': 'https://www.altai-poxod.ru/sites/default/files/styles/flexslider_full/public/programma-day-foto/file/ajax/field_tour_slides/und/form-DGHr3izfiRMbXr_cb9Ew2l5sJMqAH7xgHifg0tYxXlk/kupol002.jpg?itok=muA-WdV1',
                    'title': 'Купол'
                }
            ],
        }
```

Результат метода: JSON

* status — код HTTP, целое число:

  500 — ошибка при выполнении операции;

  400 — Bad Request (при нехватке полей);

  200 — успех.

* message — строка:

  Причина ошибки (если она была);

  Успешное отправление;

  Если отправка успешна, дополнительно возвращается id вставленной записи.
id — идентификатор, который был присвоен объекту при добавлении в базу данных.

Примеры oтветов:

{ "status": 500, "message": "Внутренняя ошибка сервера","id": null}

{ "status": 200, "message": "Успешное отправление", "id": 42 }

После того, как турист добавит в базу данных информацию о новом перевале, сотрудники ФСТР проведут модерацию для каждого нового объекта и поменяют поле status.

Допустимые значения поля status:

_'new'_;  
_'pending'_ — на рассмотрении;  
_'accepted'_ — принято;  
_'rejected'_ — отклонено.
*** 
_Метод:_
#### _**GET/submitData/\<id\>**_
получает одну запись (перевал) по её id с выведением всей информацию об перевале, в том числе статус модерации.
***
_Метод:_
#### _**PATCH/submitData/\<id\>**_

позволяет отредактировать существующую запись (замена), при условии что она в статусе "new". При этом редактировать можно все поля, кроме тех, что содержат ФИО, адрес почты и номер телефона. В качестве результата изменения приходит ответ содержащий следующие данные:

state:
1 — если успешно удалось отредактировать запись в базе данных;
0 — в отредактировать запись не удалось.

message: сообщение о причине неудачного обновления записи.
***
_Метод:_
#### _**PATCH/submitData/?user_id__email=\<email\>**_

позволяет получить данные всех объектов, отправленных на сервер пользователем с указанной почтой.

В качестве реализации использована фильтрация по адресу электронной почты пользователя с помощью пакета _**django-filter**_
***

#### _**Документация сгенерирована с помощью пакета drf-yasg**_

Документация swagger:<u>https://127.0.0.1:8000/swagger</u><br>
Документация redoc: <u>http://127.0.0.1:8000/redoc/</u>
***

В случае отправления запроса на создание записи пользователем, уже находящимся в БД, новый пользователь не создается.

***
#### _**Проект опубликован на хостинге pythonanywhere.com**_

API Pereval: <u>https://mrolegis.pythonanywhere.com/api/submitdata</u><br>
Документация swagger: <u>https://mrolegis.pythonanywhere.com/swagger/</u><br>
Документация redoc: <u>https://mrolegis.pythonanywhere.com/redoc/</u>
***
#### _**Отчет о покрытии тестами:**_

![](https://github.com/oleg-benet/PerevalAPI/blob/submitData/pereval/coverage.jpg?raw=true)

